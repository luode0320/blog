### Redis 回收机制如何工作的

Redis 主要依赖于几个内置的机制来管理和优化内存使用。这些机制包括但不限于：

1. **内存限制（maxmemory）**
2. **内存淘汰策略（maxmemory-policy）**
3. **过期键的自动删除**

### 1. 内存限制（maxmemory）

Redis 可以通过配置 `maxmemory` 选项来设置可以使用的最大内存。一旦达到这个限制，Redis 就会根据配置的内存淘汰策略来决定如何处理新来的写操作。

### 2. 内存淘汰策略（maxmemory-policy）

当 Redis 达到了 `maxmemory` 设定的内存限制时，它会根据配置的 `maxmemory-policy` 来决定如何处理新的写操作。以下是可用的一些内存淘汰策略：

- **`noeviction`**：默认策略，当内存不足时，返回错误给客户端。
- **`allkeys-lru`**：根据最近最少使用的键（Least Recently Used，LRU）来淘汰数据。
- **`allkeys-random`**：随机选择键来淘汰。
- **`volatile-lru`**：只对设置了过期时间的键使用 LRU 策略。
- **`volatile-random`**：随机选择设置了过期时间的键来淘汰。
- **`volatile-ttl`**：根据键的过期时间来淘汰数据，优先淘汰过期时间最近的键。

### 3. 过期键的自动删除

Redis 会周期性地检查是否有过期的键，并将它们从内存中删除。这个过程并不是实时发生的，而是通过定时任务来执行的。具体来说，Redis
会每隔一定的时间间隔（默认为 100 毫秒）检查过期的键，并删除一小部分。如果在这个过程中发现有很多过期键，Redis
会再次检查过期键，直到过期键的数量减少到一个合理的水平。