# ACID靠什么保证的？

### 1. **原子性（Atomicity）**

原子性指的是事务作为一个不可分割的工作单元，**要么全部成功，要么全部失败**。

如果事务的一部分执行失败，那么整个事务都应该回滚，而不是部分成功的被提交。

#### 保证方法：

- **事务日志**：MySQL使用事务日志（Redo log 和 Undo log）来记录事务中的所有更改。如果事务的一部分失败，可以使用Undo
  log来回滚未提交的更改。
    - 我们做增、删、改这样一些 SQL 操作，它之前已经保留好一个历史版本数据了，而这个历史版本数据会存在于 undolog 中
        - 我们写一条`insert`,就会记录一条`delete`
    - 所以当你进行回滚的时候，它会找到你对应的一个历史版本数据
    - 然后进行回写，把之前成功执行的 SQL 语句给你撤销掉，这个时候就完成了最基本的一个回滚操作，这是原子性对应的一个保证。
- **事务管理器**：数据库中的事务管理器负责跟踪事务状态，并确保只有在所有操作都成功完成后才提交事务。

例如: 执行的是一个批量插入的SQL语句, 如果过程中有一条记录因为唯一性等原因, 插入失败了

- **没有显式地开启事务**: 从这条记录报错, 后面的数据不会被插入, 批量插入的SQL语句通常是逐行处理的, 前面成功的数据不会回滚
- **显式地开启事务**: 整条批量sql都会回滚

### 2. **一致性（Consistency）**

一致性保证事务的执行不会破坏数据库的完整性约束，事务执行前后，数据库都应该处于一致的状态。

保证原子性、持久化、隔离性都是为了保证一致性

#### 保证方法：

- **约束检查**：在事务执行过程中，数据库会对每一步操作进行约束检查，确保数据符合预定义的规则（如唯一性、外键约束等）。
- **触发器和存储过程**：可以用来执行复杂的事务逻辑，确保数据的一致性。
- **事务隔离级别**：不同的事务隔离级别可以防止事务之间的干扰，确保数据的一致性。

### 3. **隔离性（Isolation）**

隔离性指的是多个并发事务之间的操作不会相互干扰。每个事务都应该与其他事务隔离开来，就好像它是系统中唯一发生的事务一样。

#### 保证方法：

- **锁机制**：MySQL使用多种锁机制（如行锁、间隙锁、共享锁S、排他锁X等）来控制并发事务对数据的访问。
- **事务隔离级别**：不同的隔离级别提供了不同程度的隔离，如读未提交（Read Uncommitted）、读已提交（Read
  Committed）、可重复读（Repeatable Read）和序列化（Serializable）。
- **MVCC（多版本并发控制）**：InnoDB存储引擎使用MVCC来支持可重复读（Repeatable Read）隔离级别下的并发事务执行。MVCC允许事务看到其他已提交事务的
  **快照视图 (read view)**，而不必等待其他事务完成。

### 4. **持久性（Durability）**

持久性指的是一旦事务被提交，它的结果就会被永久保存下来，即使系统在此之后发生故障也不会丢失已经提交的数据。

#### 保证方法：

- 持久性由 `redolog `来进行保证
- 当我们要修改数据时，MySQL是先把这条记录所在的「页」(也就是B+树上的叶子节点) 找到，然后把该页加载到内存中，在内存中进行修改。
- 还会写一份redo log，这份redo log记载着这次在某个页上做了什么修改、执行了什么sql。
- 即便MySQL在中途挂了，我们还可以根据redo log来对数据进行恢复。



