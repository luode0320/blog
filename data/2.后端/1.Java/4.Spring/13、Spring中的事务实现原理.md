# Spring中的事务实现原理

- Spring事务底层是基于**数据库事务和AOP机制**的 

- ⾸先对于使⽤了@Transactional注解的Bean，**Spring会创建⼀个代理对象作为Bean** 

- 当调⽤代理对象的⽅法时，会先判断该⽅法上是否加了`@Transactional注解 `

- 如果加了，那么则Spring AOP的机制执行方法前利⽤**事务管理器创建⼀个数据库连接** 

- 并且修改数据库连接的`autocommit属性为false`，**禁⽌此连接的⾃动提交**，数据库得保证有这个功能

- 然后`执⾏当前⽅法`，⽅法中会**执⾏sql** 
  - 如果中间需要调用**别的方法**,需要配置好需要的**事务传播机制**
  - 默认的传播机制就是`REQUIRED`,继续用存在的数据库连接
  - 传播机制为`REQUIRES_NEW`就**重新建⽴⼀个数据库连接，在此新数据库连接上执⾏sql** 

- 执⾏完当前⽅法后，如果`没有出现异常就直接提交事务 `

- 如果出现了异常，并且这个异常是需要回滚的就会**回滚事务**，否则仍然提交事务 

