### 以太坊（Ethereum）

在2022年9月，以太坊完成了从PoW向权益证明（Proof of Stake, PoS）的转变，称为“The Merge”。PoS机制下的出块流程有所不同：

1. **交易广播**：与比特币类似，交易被创建后会广播到整个网络。
2. **验证者选择**：在PoS机制下，验证者不是通过解决计算难题来获得记账权，而是根据持有以太币的数量以及时间来决定谁有资格创建下一个区块。
3. **打包交易**：验证者会选择一批交易来打包成一个新的区块。
4. **签名并广播**：验证者会对打包好的区块进行数字签名，然后将其广播给网络中的其他节点。
5. **区块确认**：网络中的其他节点接收到新的区块后会对其进行**验证**，如果符合规则，则接受该区块并更新自己的区块链副本。

### 比特币（Bitcoin）

比特币使用的是工作量证明（Proof of Work, PoW）机制来达成共识。出块流程如下：

1. **交易广播**：当一笔交易发生时，它会被广播到整个比特币网络中。
2. **矿工验证**：矿工会收到这笔交易，并对交易的有效性进行验证，包括确认发送者的余额足够支付此次交易金额等。
3. **打包交易**：矿工会将通过验证的交易放入一个区块中。
4. **解决计算难题**：为了能够将这个区块添加到区块链上，矿工需要解决一个复杂的数学问题，这通常涉及到寻找一个满足一定条件的哈希值。
5. **区块传播**：一旦某个矿工找到了正确的解，就会把这个区块的信息广播给网络中的其他节点。
6. **区块确认**：其他节点会验证新区块的信息是否正确，如果正确则接受这个区块并将其添加到自己的区块链副本中。

### Fabric 的出块流程

1. **客户端发起交易提案**：
    - 客户端应用程序首先构造一个交易提案（Transaction Proposal），该提案包含拟议的交易及其相关参数。
2. **背书节点处理提案**：
    - 交易提案被发送到一个或多个背书节点（Endorser Peers），这些节点根据链码（Chaincode）逻辑来执行交易并返回结果。背书节点还可能需要根据预先设定的背书策略来验证交易。
3. **客户端收集背书响应**：
    - 客户端应用程序收集所有背书节点返回的结果，并检查是否满足背书策略的要求。如果满足要求，客户端将构建完整的交易请求。
4. **排序服务接收并排序交易**：
    - 客户端将交易发送给排序服务。排序服务负责接收来自不同客户端的交易，并将它们按顺序打包成区块。
5. **区块广播至成员节点**：
    - 排序服务将排序后的区块广播给所有通道中的成员节点（Peer Nodes）。
6. **成员节点验证区块**：
    - 成员节点接收到区块后，会验证区块中的每笔交易。验证过程包括但不限于检查交易的有效性、执行结果以及背书信息等。
7. **区块提交至区块链**：
    - 如果所有验证都成功，成员节点会将区块添加到本地的区块链副本中，并更新状态数据库（如LevelDB或CouchDB）以反映最新的状态。
8. **事件通知**：
    - 成功提交区块后，Fabric 可以通过事件机制通知相关的监听器（Listener），以便应用程序可以得知交易的结果。

