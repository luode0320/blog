### 如果智能合约的执行成本低于调用方指定的gas用量，用户是否得到退款

是的。

如果智能合约的执行成本**低于**调用方指定的 Gas 用量，用户会得到**剩余 Gas 的退款**。

这一机制确保了用户不会为未使用的 Gas 付费，同时也避免了浪费计算资源的情况。

### 具体过程

1. **设置 Gas Limit**：

    - 用户在发送交易时需要设置 Gas Limit，即用户愿意支付的最大 Gas 用量。
    - 这个 Gas Limit 是用户为**最坏情况准备的**，即在最复杂的情况下可能需要的 Gas 用量。

2. **Gas Price**：

    - 用户还需要设置 Gas Price，即用户愿意为每单位 Gas 支付的价格。
    - Gas Price 决定了交易的优先级，较高的 Gas Price 可以使交易更快被处理。

3. **交易执行**：

    - 当交易被打包进区块后，EVM（Ethereum 虚拟机）开始执行交易中的智能合约代码。
    - 每一步操作都会消耗一定的 Gas，直到交易完成或 Gas 被用尽。

4. **Gas 退款**：

    - 如果实际消耗的 Gas 用量**少于用户设置的 Gas Limit**，那么剩余的 Gas 会被退还给用户。
    - 退款的计算公式为：

   ```
   退款=(Gas Limit−Gas Used) × Gas Price
   ```

   