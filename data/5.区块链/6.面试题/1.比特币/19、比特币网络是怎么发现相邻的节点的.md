### 比特币网络是怎么发现相邻的节点的

比特币网络中的节点发现（Node Discovery）是一个自动的过程，它允许节点找到并连接到网络中的其他节点。

这一过程不需要用户手动配置，而是通过以下几个步骤自动完成的：

### 1. 初始种子节点

当一个新节点启动时，它会从一组预设的“种子节点”开始连接。这些种子节点是硬编码在比特币客户端软件中的，作为新节点加入网络的初始连接点。这些种子节点通常是由
**比特币核心开发者团队选定的可靠节点**。

### 2. DNS 种子节点

除了硬编码的种子节点外，比特币网络还利用DNS种子节点（DNS Seeds）来帮助新节点找到网络中的其他节点。

DNS种子节点是指通过DNS查询来获取的节点列表。这些DNS种子节点通常指向运行着多个比特币节点的服务器，这些服务器可以返回当前活跃的比特币节点列表。

### 3. 使用`getaddr`消息

一旦节点连接到初始的种子节点或通过DNS种子节点获取到其他节点信息后，它就可以开始与其他节点交换信息。比特币协议中有一个`getaddr`
消息，用于请求其他节点的信息。当一个节点发送`getaddr`消息时，接收节点会响应一个包含其知道的其他节点信息的`addr`消息。

### 4. 扩散和维护连接

节点会持续使用上述方法来发现新的节点，并维护一个活动节点列表。此外，节点还会定期清理那些长时间未响应或断开连接的节点，以保持其连接列表的更新。

### 5. P2P网络拓扑

比特币网络是一个对等网络（Peer-to-Peer Network），每个节点都可以既是客户端又是服务器。这意味着节点可以同时接收来自其他节点的数据并发送数据给其他节点。这种双向通信有助于网络拓扑的动态构建和维护。

### 6. 网络层优化

比特币网络还包括一些优化措施，比如节点会尽量避免与同一个IP地址段内的节点重复连接，以减少冗余连接和带宽消耗。

### 总结

总体而言，比特币网络中的节点发现是一个自动化的过程，它通过预设的种子节点、DNS种子节点、`getaddr`
消息交换以及其他网络层优化措施来实现。用户无需手动配置就能让节点自动发现并连接到比特币网络中的其他节点。这一机制确保了比特币网络的高度连通性和去中心化特性。