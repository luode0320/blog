### 哪些变量存储在Storage，那些变量存储在Memory

状态变量和局部变量（它们是对状态变量的引用）存储在Storage区域， 函数参数位于Memory区域。

### 存储（Storage）

存储（Storage）通常用于持久化存储数据，这些数据需要在合约的整个生命周期内存在，并且在每次交易后仍然可用。以下是一些通常存储在存储中的变量类型：

1. **状态变量（State Variables）**：
    - 合约中的全局变量，通常是 `public` 或 `private` 关键字声明的变量。
    - 这些变量在整个合约的生命周期内是持久化的，并且在每次交易结束后仍然存在。

2. **映射（Mappings）**：
    - 映射是一种特殊的键值对数据结构，其键和值都存储在存储中。
3. **结构体（Structs）作为状态变量**：
    - 如果一个结构体作为状态变量存储在存储中，那么结构体中的所有字段也会存储在存储中。
4. **数组（Arrays）作为状态变量**：
    - 如果数组作为状态变量存储在存储中，那么数组中的所有元素也会存储在存储中。

### 内存（Memory）

内存（Memory）通常用于存储临时数据，这些数据只在当前交易执行期间有效，并且在交易完成后会被释放。以下是一些通常存储在内存中的变量类型：

1. **局部变量（Local Variables）**：
    - 在函数内部声明的局部变量默认存储在内存中。
2. **函数参数（Function Parameters）**：
    - 函数的参数默认存储在内存中。
3. **返回值（Return Values）**：
    - 函数的返回值默认存储在内存中。
4. **动态数组（Dynamic Arrays）**：
    - 如果动态数组作为局部变量或函数参数存储，则它们存储在内存中。
5. **结构体（Structs）作为局部变量或参数**：
    - 如果结构体作为局部变量或函数参数存储，则它们存储在内存中。
6. **映射（Mappings）的副本**：
    - 如果需要将映射的某个键对应的值存储在内存中进行操作，可以创建一个副本。

### 映射（Mapping）始终存储在存储（Storage)

Solidity 中的映射（Mapping）确实是一种特殊的键值对数据结构，其键和值都存储在存储（Storage）中。

映射不会存储在内存（Memory）中，而是始终存储在存储（Storage）中

**映射（Mapping）的特点:**

1. **键值对结构**：
    - 映射是一种键值对数据结构，其中键（key）是唯一的，而值（value）可以是任意类型的数据。
2. **存储位置**：
    - 映射的键和值都存储在存储（Storage）中，而不是内存（Memory）中。这是因为映射需要持久化存储数据，并且需要在整个合约的生命周期内保持不变。
3. **只读特性**：
    - 映射不能直接在纯函数 (`pure`) 或视图函数 (`view`) 中使用，因为这些函数不允许修改存储中的数据。只有在非视图函数中才能修改映射中的数据。

**映射的限制:**

1. **键的类型**：

    - 映射的键只能是 `address` 或 `bytes32` 类型。这是因为 Solidity 需要将键哈希成一个固定大小的值。

2. **不可复制到内存**：

    - 你不能直接将映射复制到内存中，但如果需要在内存中处理映射中的数据，可以创建一个映射值的副本。

### 总结

- **存储（Storage）**：适合存储需要持久化的状态变量、映射、结构体和数组。
- **内存（Memory）**：适合存储临时的局部变量、函数参数、返回值、动态数组、结构体副本等。