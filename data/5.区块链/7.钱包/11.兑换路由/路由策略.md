# 权重分

策略需要组合使用, 需要对每个策略定义权重, 最后去得分最高的交易所下单



# 币对

作用: 不同的币对优先走配置的交易所

- 某个币单兑入／单兑出优先



# 实时汇率

作用: 优先汇率最高的交易所兑换

- **兑入数量(扣除gas+ellipal收费+交易所收费) / 兑出数量 = 汇率**
- 不同交易所收费策略也是不同的, 得到的汇率也是不一致的
- 汇率越高用户收到的币可能会更多, 但是收益可能会更少



# 待兑换价值（兑出币种）

作用: 根据兑换价值分单, 例如: 1w以上不走changelly

- 兑出数量 * 币价= 待兑换价值



# 预计兑换后价值（兑入币种）

作用: 优先预计兑入最多的交易所进行兑换

- **兑入币数量 * 兑入币价值 * (历史兑换隐藏的扣费比例) = 预计兑换后价值**
- 不同交易所最后得到的兑入币数量是不同的, 而且会出现一些暗扣
- 就算一个汇率最高的交易所, 最后用户实际收到的不一定是最多的
- 不能完全按照汇率来判断兑入币数量是否最多, 实际完成兑换的数据和汇率结果是不一致的
- 真正哪个交易所兑入多, **需要统计一段时间内的数据进行分析**



# 预计收益（首选从接口获取，其次自行计算）

作用: 优先收益最高的交易所兑换

- 如果是 自有兑换 | SWFT, 使用 amount(兑出数量) 处理
  - **待兑换价值 * 收费策略 = 收益**
- 如果是 Changelly | ChangeNow, 用 Volumelast(用户实际收到的数量) 处理
  - **预计兑换后价值 * 收费策略 = 收益**



# 时间段统计分单

作用: 不出现一个交易所分到大量订单, 另一个交易所单少的问题

- 统计一段时间内的数据进行分析, 如果前一个时间段某个交易所订单量很大
- 下一个时间段分配订单这个交易所优先级靠后



# 自定义标签





# DEX滑点问题





# 代码

1. 每个策略都写成一个代码文件, 然后在数据库配置这个策略的名称和对应的权重分数

   - 假设有 [币对、汇率、待兑换价值、预计兑换后价值、收益] 这些策略
   - 策略被命中默认是100的最大分数
   - 管理系统可配置策略最大分数, 最优的交易所得分最高, 然后依次20%递减

   

2. 管理系统为每个交易所自由选择0个或者多个策略组合为路由策略

   

3. 代码执行过程中, 每个交易所会将这些配置的策略全部执行, 将命中的策略分数累加

   - 假设:
   - ellipal命中 [币对(100)、汇率(80)、待兑换价值(100)、收益(100)] = 380分
   - changenow命中 [币对(100)、汇率(64)、预计兑换后价值(100)、收益(80)] =344分
   - changelly命中 [币对(100)、汇率(100)、收益(64)]  = 264分
   - 最终 ellipal 交易所获得 380 分, 执行下单