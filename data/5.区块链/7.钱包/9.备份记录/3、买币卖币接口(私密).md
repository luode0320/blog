# API官网

[官网](https://dev.moonpay.com/reference/get_v1-transactions)



# 验证签名

[验证签名官网](https://dev.moonpay.com/reference/reference-webhooks-signature)

MoonPay 会对**我们发送到您**的端点的 webhook 事件和请求进行签名。MoonPay 通过在每个事件的标头中包含签名来实现这一点。

这**允许您验证**事件和请求是由 MoonPay 发送的，而不是由第三方发送的。

MoonPay 使用基于哈希的消息认证码 [HMAC](https://en.wikipedia.org/wiki/HMAC) (一个密钥) 和 [SHA-256](https://en.wikipedia.org/wiki/SHA-2) 算法生成的签名 -> `HMAC-SHA256(key, message)`

- `Moonpay-Signature-V2`标头包含一个时间戳和一个签名。时间戳以t=为前缀，签名以s=为前缀。

  ```
  Moonpay-Signature-V2: t=1492774577,s=5257a869e7ecebeda32affa62cdca3fa51cad7e77a0e56ff536d0ce8e108d8bd
  ```

- 签名s字符串格式：`时间戳.请求体`

  - `POST` 请求通常会携带一个 **请求体**（Body），包含了发送到服务器的数据。

    假设 `POST` 请求的时间戳是 `1492774577`，Body 是：

    ```json
    {
      "example": "data",
      "id": 123
    }	
    ```

    构造签名字符串是：

    ```
    "1492774577.{\"example\":\"data\",\"id\":123}"
    ```

  - `GET` 请求通常不包含请求体，而是通过 URL 的查询参数（Query String）传递数据。

    假设 `GET` 请求的时间戳是 `1492774577`，查询参数是：

    ```json
    ?externalCustomerId=adbb317d-cde9-4ebb-93a3-1b271812de06
    ```

    构造签名字符串：

    ```
    "1492774577.?externalCustomerId=adbb317d-cde9-4ebb-93a3-1b271812de06"
    ```

- 解析出的 **时间戳t** 和 **请求的实际负载**，用 `.` 连接通过 `HMAC-SHA256` 算法生成的签名 = 签名s



# 购买

## 列出购买交易

```sh
curl --request GET \
     --url https://api.moonpay.com/v1/transactions \
     --header 'Authorization: pk_live_SGCdGCsO4JCl8YaMTMzCaYFLdiedTNS' \
     --header 'accept: application/json'
```



# 卖出

## 列出卖出交易

[参数响应看官网](https://dev.moonpay.com/reference/get_v3-sell-transactions)

返回满足查询参数中提供的条件的成功卖出交易数组。

数组中的每个条目都是一个单独的交易对象。交易将按从最新到最旧的方式列出。如果查询参数中未提供，此调用将返回错误。

```
get
https://api.moonpay.com/v3/sell_transactions
```

```sh
curl --request GET \
     --url 'https://api.moonpay.com/v3/sell_transactions?externalTransactionId=123&customerId=123&externalCustomerId=123&startDate=2023-07-01&endDate=2023-07-31&limit=20&offset=1' \
     --header 'Authorization: 123' \
     --header 'accept: application/json'
```

## 取消卖出交易

[参数响应看官网](https://dev.moonpay.com/reference/delete_v3-sell-transactions-transactionid)

取消销售交易。如果销售交易已成功取消，此端点将返回 HTTP 状态204 无内容。

如果销售交易无法取消（例如因为交易已完成），它将返回 HTTP 状态409 冲突。

```
delete
https://api.moonpay.com/v3/sell_transactions/{transactionId}
```

```sh
curl --request DELETE \
     --url https://api.moonpay.com/v3/sell_transactions/123 \
     --header 'Authorization: 123' \
     --header 'accept: application/json'
```

## 通过外部ID取消卖出交易

[参数响应看官网](https://dev.moonpay.com/reference/delete_v3-sell-transactions-ext-transactionid)

根据外部交易 ID 取消销售交易。如果销售交易已成功取消，此端点将返回 HTTP 状态204 无内容。

如果销售交易无法取消（例如因为交易已完成），它将返回 HTTP 状态409 冲突。

```
delete
https://api.moonpay.com/v3/sell_transactions/ext/{transactionId}
```

```sh
curl --request DELETE \
     --url https://api.moonpay.com/v3/sell_transactions/ext/transactionId/{交易id} \
     --header 'Authorization: pk_live_SGCdGCsO4JCl8YaMTMzCaYFLdiedTNS' \
     --header 'accept: application/json'
```

## 获取销售报价

[参数响应看官网](https://dev.moonpay.com/reference/getsellquote)

返回一组表示货币实时卖出报价的键值对。

提供货币代码、基础金额、额外费用百分比、付款方式以及基础金额是否包含费用，MoonPay 将返回详细的卖出报价。

```
get
https://api.moonpay.com/v3/currencies/{currencyCode}/sell_quote
```

```sh
curl --request GET \
     --url 'https://api.moonpay.com/v3/currencies/eth/sell_quote?quoteCurrencyCode=usd&baseCurrencyAmount=3&extraFeePercentage=1&payoutMethod=paypal&apiKey=123' \
     --header 'accept: application/json'
```



## 获取卖出交易

[参数响应看官网](https://dev.moonpay.com/reference/getselltransaction)

根据 ID 检索销售交易。如果不存在具有所提供标识符的销售交易，此调用将返回错误。

```
get
https://api.moonpay.com/v3/sell_transactions/{transactionId}
```

```sh
curl --request GET \
     --url 'https://api.moonpay.com/v3/sell_transactions/dab3bdf4-e6ea-40a2-ad74-87536f9e8a7d?apiKey=123' \
     --header 'accept: application/json'
```



## 通过外部标识符获取销售交易

[参数响应看官网](https://dev.moonpay.com/reference/getselltransactionbyexternalid)

通过 externalTransactionId 检索交易。这是您在创建交易时为其分配的标识符。

此端点返回一个对象数组，因为我们无法确保 externalTransactionId 的唯一性。

```
get
https://api.moonpay.com/v3/sell_transactions/ext/{externalTransactionId}
```

```sh
curl --request GET \
     --url 'https://api.moonpay.com/v3/sell_transactions/ext/bc976ff6-c89d-4c35-9694-ae183758abf5?apiKey=123' \
     --header 'accept: application/json'
```

