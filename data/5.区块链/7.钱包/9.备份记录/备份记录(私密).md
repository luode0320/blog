# 备份记录(私密)



# 节点

```
https://wallettest.ellipal.com/images/bscnew.png
http://wallet.ellipal.com/images/bch.png
http://wallet.ellipal.com/images/xlmnew.png
https://wallet.ellipal.com/images/ltc.png
http://www.w3.org/2000/svg
```

```
php日志目录: tail -f -n 11 /data/wwwroot/wallet/storage/logs/laravel-2024-10-24.log
php部署目录: /root/wallet
```

```
nTqm.8VjUaU-PY:
```



# TG

```sh
id=c2ef8595-214e-4ec8-9d2d-9ca3ed5fb658,

Hello, it has been over 4 hours. Please help me check the order.
```

```sh
id=c41d5fdd-37fe-4b03-a1c9-e2921c5aefd1,

你好，已经4个多小时了。请帮我查一下订单。
```



# 日志

## 自有兑换

```sh
# 日志目录
cd /data/repos/exchange/logs
# 日志备份目录
cd /data/repos/exchange/logs/archive

# 解压日志
gunzip /data/repos/exchange/logs/archive/exchange-ellipal-5075.log.2024-11-24.0.gz

# 通用
tail -f -n 11111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep "\-\-\-\-\-\-"

# 轮询转账状态
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep "轮询转账状态开始"

# 兑换对冲买现货开空单
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep "对冲兑"

# 链上确认成功
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep "链上确认成功"
# 链上确认失败
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep "链上确认失败"

# 兑换: 
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep --color=always "兑换结束:.*false\|兑换结束:"
# 兑换完成
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep "兑换结束: 状态: true"
# 兑换错误
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep "兑换结束: 状态: false"


# 对冲入口
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep -E "对冲第一步|对冲初始化"
# 对冲充币
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep --color=always -E "对冲初始化: 充币到交易所|充币到交易所, 状态:.*false|充币到交易所, 状态:"
# 对冲提币
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep -E "对冲初始化: 提币到币池|提币到币池完成"
# 对冲交易所到账, 卖现货平合约
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep -E "对冲初始化: 充币到交易所|交易所确认到账成功|对冲结束"

# 链上确认开始
tail -f -n 11111111 /data/repos/exchange/logs/exchange-ellipal-5075.log | grep "链上确认开始"
```

### 一笔订单下单到转账的日志过程

- 创建订单

```sh
2024-11-25 11:43:56.664  INFO 3845102 [http-nio-5075-exec-9] e.c.s.i.InternalExchangeOrderServiceImpl : --------------创建交易:DOT(DOT)_XRP(XRP) 参数: {"extOrderId":"ewtnf3206c4f2a4d4799a7ccb8e6d42e763b","fromAmount":2.4,"fromUserAddress":"12mf4KDKtT5WKcWfXmNMFhb8AEpZfHXQzak2Ec9ovtkPeU2x","lContractAddress":"","lName":"DOT","lNetwork":"DOT","profitTag":1,"rContractAddress":"","rName":"XRP","rNetwork":"XRP","refundAddress":"12mf4KDKtT5WKcWfXmNMFhb8AEpZfHXQzak2Ec9ovtkPeU2x","toUserAddress":"rnM7pNxm2mpEky891CrGc3waDJFqzryFkK"}
2024-11-25 11:43:56.696  INFO 3845102 [http-nio-5075-exec-9] e.c.s.i.InternalExchangeOrderServiceImpl : --------------创建交易:DOT(DOT)_XRP(XRP) 保存交易订单: 兑出数量:2.4, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D
2024-11-25 11:43:56.697  INFO 3845102 [http-nio-5075-exec-9] c.e.c.e.c.EllipalExchangeController      : --------------创建交易:DOT(DOT)_XRP(XRP) 创建交易结束: 状态: WAITING_PAYMENT, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D,{"createTime":1732506236685,"orderId":"EPL229B3712FB5C4FDA99EFB46BB3645B2D","platformReceiveAddress":"13x71ftQsWFj7tHNwZzizq4Fpu4TDpANJV4j5BPsZraWm2MA","profitRate":0.0000,"tag":"","txStatus":"WAITING_PAYMENT"}
```

- 轮询状态

```sh\
2024-11-25 11:45:06.090  INFO 3845102 [scheduling-10] e.c.e.c.t.EllipalOrderTraceTaskScheduler : --------------下单第一步: 轮询转账状态, 剩余待兑换订单数: 1
2024-11-25 11:45:06.091  INFO 3845102 [scheduling-10] e.c.e.c.t.EllipalOrderTraceTaskScheduler : --------------下单第一步:DOT(DOT)_XRP(XRP) 轮询转账状态开始: orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D
2024-11-25 11:45:06.136  INFO 3845102 [scheduling-10] e.c.e.c.t.EllipalOrderTraceTaskScheduler : --------------下单第一步: 轮询转账状态完成: 已支付订单单数 1 ,单号 = ["EPL229B3712FB5C4FDA99EFB46BB3645B2D"]
2024-11-25 11:45:06.136  INFO 3845102 [scheduling-10] e.c.e.c.t.EllipalOrderTraceTaskScheduler : --------------下单第一步: 轮询转账状态完成: 已超时支付订单单数 0,单号 = []
```

- 对冲下单

```sh
2024-11-25 11:45:07.095  INFO 3845102 [scheduling-4] e.c.e.c.t.EllipalOrderTraceTaskScheduler : --------------下单第二步: 对冲下单: 买现货开合约--------------
2024-11-25 11:45:07.200  INFO 3845102 [scheduling-4] e.c.e.c.t.EllipalOrderTraceTaskScheduler : --------------下单第二步:DOT(DOT)_XRP(XRP) 对冲兑出开空单: 数量: 2.4, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D, 参数:{"symbol":"DOTUSDT","side":"SELL","type":"MARKET","quantity":"2.4","newClientOrderId":"x-mKqxv5Yr-ellipal","timestamp":"1732506307118"}, 结果:"{\"orderId\":25251795837,\"symbol\":\"DOTUSDT\",\"status\":\"NEW\",\"clientOrderId\":\"x-mKqxv5Yr-ellipal\",\"price\":\"0.000\",\"avgPrice\":\"0.00\",\"origQty\":\"2.4\",\"executedQty\":\"0.0\",\"cumQty\":\"0.0\",\"cumQuote\":\"0.0000\",\"timeInForce\":\"GTC\",\"type\":\"MARKET\",\"reduceOnly\":false,\"closePosition\":false,\"side\":\"SELL\",\"positionSide\":\"BOTH\",\"stopPrice\":\"0.000\",\"workingType\":\"CONTRACT_PRICE\",\"priceProtect\":false,\"origType\":\"MARKET\",\"priceMatch\":\"NONE\",\"selfTradePreventionMode\":\"NONE\",\"goodTillDate\":0,\"updateTime\":1732506307160}"
2024-11-25 11:45:07.300  INFO 3845102 [scheduling-4] e.c.e.c.t.EllipalOrderTraceTaskScheduler : --------------下单第二步:DOT(DOT)_XRP(XRP) 对冲兑入买现货: 数量: 14, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D, 参数:{"symbol":"XRPUSDT","newClientOrderId":"x-KW4K2JEH-ellipal","side":"BUY","quantity":"14","signature":"15c57b6c4183edccf50bc2d48fd56e58f3f8889c358b811a7deac3153bce23a8","type":"MARKET","timestamp":"1732506307226"}, 结果:"{\"symbol\":\"XRPUSDT\",\"orderId\":7119562395,\"orderListId\":-1,\"clientOrderId\":\"x-KW4K2JEH-ellipal\",\"transactTime\":1732506307265,\"price\":\"0.00000000\",\"origQty\":\"14.00000000\",\"executedQty\":\"14.00000000\",\"cummulativeQuoteQty\":\"19.60000000\",\"status\":\"FILLED\",\"timeInForce\":\"GTC\",\"type\":\"MARKET\",\"side\":\"BUY\",\"workingTime\":1732506307265,\"fills\":[{\"price\":\"1.40000000\",\"qty\":\"14.00000000\",\"commission\":\"0.01400000\",\"commissionAsset\":\"XRP\",\"tradeId\":739319149}],\"selfTradePreventionMode\":\"EXPIRE_MAKER\"}"
```

- 兑换转账

```sh
2024-11-25 11:46:04.133  INFO 3845102 [internal-task-thread-0] c.e.c.e.c.runnable.ExchangeTransferTask  : --------------下单第三步:DOT(DOT)_XRP(XRP) 兑换转账开始: orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D,{"actualLPrice":8.69100000,"actualRPrice":1.40040000,"actualToAmount":13.98600000,"createTime":1732506237000,"expireTime":1732592637000,"extOrderId":"ewtnf3206c4f2a4d4799a7ccb8e6d42e763b","fromAmount":2.40000000,"fromUserAddress":"12mf4KDKtT5WKcWfXmNMFhb8AEpZfHXQzak2Ec9ovtkPeU2x","id":573,"lContractAddress":"","lName":"DOT","lNetwork":"DOT","orderId":"EPL229B3712FB5C4FDA99EFB46BB3645B2D","platformOutAddress":"rLHUm6jyCN77BuigrTMHBrkUjstd5mEdgt","platformReceiveAddress":"13x71ftQsWFj7tHNwZzizq4Fpu4TDpANJV4j5BPsZraWm2MA","profitRate":0.0000,"profitTag":1,"rContractAddress":"","rName":"XRP","rNetwork":"XRP","receiveAmount":2.40000000,"refundAddress":"12mf4KDKtT5WKcWfXmNMFhb8AEpZfHXQzak2Ec9ovtkPeU2x","status":"WAITING_EXCHANGE","toAmount":14.85720361,"toUserAddress":"rnM7pNxm2mpEky891CrGc3waDJFqzryFkK","txHashIn":"0x79dcd455723a63a561ccb28d41f763660adc6663eda4a33cea2a12f6058bc178","updateTime":1732506307000,"usualLPrice":8.66100000,"usualRPrice":1.39740000}
2024-11-25 11:46:06.709  INFO 3845102 [internal-task-thread-0] c.e.c.e.c.t.xrp.XRPTransferProcessor     : --------------转账发送签名请求req:XRP(XRP) orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D, url:https://wallettest.ellipal.com/api/transaction, 参数:{"agency":"20","amount":"13986000","cAddress":"rLHUm6jyCN77BuigrTMHBrkUjstd5mEdgt","cType":"XRP","contractAddr":"","dAddress":"rnM7pNxm2mpEky891CrGc3waDJFqzryFkK","gApikey":"a5bf75b38c229ffae09d39b132156622","gDeviceID":"ellipal_internal_transfer","gPlatform":"Web","gVersion":250,"gasLimit":"1","httpType":"req","memoId":"404094525","orderId":"EPL229B3712FB5C4FDA99EFB46BB3645B2D","pubkey":"025BA08A83394BD1321A3BC3C421D9920A9749880E5D2B9433B09560805BAA912D","tipdot":"0","walletType":"h_1"}, 结果:{"code":0,"data":{"fee":"0","prev_amount":"","sign":"35af68ef28fc57aedac674ddccc12867854ec99a527b0fd0e11dfce0207526e1","tx":"1200002280000000240530056D2E1815FE3D614000000000D568D06840000000000000147321025BA08A83394BD1321A3BC3C421D9920A9749880E5D2B9433B09560805BAA912D8114D37ADEF959D6423CFA1EE1B76938C53B1ECF233E83142FBF60F2019561E0C525ED92850B164C5D916F8C","txDigest":"35af68ef28fc57aedac674ddccc12867854ec99a527b0fd0e11dfce0207526e1"},"msg":"success","status":true}
2024-11-25 11:46:08.730  INFO 3845102 [internal-task-thread-0] c.e.c.e.c.t.xrp.XRPTransferProcessor     : --------------转账ws接收交易签名:XRP(XRP) 状态: true, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D, 参数 = {"contractAddr":"","network":"XRP","orderId":"EPL229B3712FB5C4FDA99EFB46BB3645B2D","status":"WAITING_EXCHANGE","symbol":"XRP","unSignedHash":"35af68ef28fc57aedac674ddccc12867854ec99a527b0fd0e11dfce0207526e1","walletAddr":"rLHUm6jyCN77BuigrTMHBrkUjstd5mEdgt","walletType":"h_1"}, 结果 = {"data":{"tx_unsigned":"D822AEB27B10CFF3FA7A12B7D566822D1A5A5766A7A79511EBF0FA290D864A6009472A1D02BEAE5EDB70F1121F05985DB8E51D4A4B5B7E6EA500D3D679CEF756"},"status":true}
2024-11-25 11:46:09.048  INFO 3845102 [internal-task-thread-0] c.e.c.e.c.t.xrp.XRPTransferProcessor     : --------------转账第一步:XRP(XRP) 得到交易签名, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D, 签名:TransferSignRespDTO(r=null, s=null, v=null, txUnsigned=D822AEB27B10CFF3FA7A12B7D566822D1A5A5766A7A79511EBF0FA290D864A6009472A1D02BEAE5EDB70F1121F05985DB8E51D4A4B5B7E6EA500D3D679CEF756, walletType=null)
2024-11-25 11:46:09.807  INFO 3845102 [internal-task-thread-0] c.e.c.e.c.t.xrp.XRPTransferProcessor     : --------------转账第二步:XRP(XRP) 执行转账, 状态: true, 数量: 13986000, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D, url:https://wallettest.ellipal.com/api/transaction, 参数 = {"agency":"20","amount":"13986000","cAddress":"rLHUm6jyCN77BuigrTMHBrkUjstd5mEdgt","cType":"XRP","contractAddr":"","dAddress":"rnM7pNxm2mpEky891CrGc3waDJFqzryFkK","gApikey":"a5bf75b38c229ffae09d39b132156622","gDeviceID":"ellipal_internal_transfer","gPlatform":"Web","gVersion":250,"gasLimit":"1","httpType":"send","memoId":"404094525","orderId":"EPL229B3712FB5C4FDA99EFB46BB3645B2D","pubkey":"025BA08A83394BD1321A3BC3C421D9920A9749880E5D2B9433B09560805BAA912D","sig":"D822AEB27B10CFF3FA7A12B7D566822D1A5A5766A7A79511EBF0FA290D864A6009472A1D02BEAE5EDB70F1121F05985DB8E51D4A4B5B7E6EA500D3D679CEF756","tipdot":"0","tx_unsigned":"1200002280000000240530056D2E1815FE3D614000000000D568D06840000000000000147321025BA08A83394BD1321A3BC3C421D9920A9749880E5D2B9433B09560805BAA912D8114D37ADEF959D6423CFA1EE1B76938C53B1ECF233E83142FBF60F2019561E0C525ED92850B164C5D916F8C","walletType":"h_1"}, 结果 = {"code":0,"data":{"txid":"753159ab6c2b24afec36b349d27ad3778d5f479684c1c0ddbe9b57c378a92fa6"},"msg":"success","status":true}
```

- 转账确认

```sh
2024-11-25 11:46:09.807  INFO 3845102 [internal-task-thread-0] c.e.c.e.c.t.xrp.XRPTransferProcessor     : --------------转账第三步:XRP 链上确认开始, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D, 地址: rLHUm6jyCN77BuigrTMHBrkUjstd5mEdgt, hash: 753159ab6c2b24afec36b349d27ad3778d5f479684c1c0ddbe9b57c378a92fa6, 并发间隔: 600s
2024-11-25 11:46:30.131  INFO 3845102 [internal-task-thread-0] c.e.c.e.c.t.xrp.XRPTransferProcessor     : --------------转账第三步:XRP 链上确认成功, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D, 地址: rLHUm6jyCN77BuigrTMHBrkUjstd5mEdgt, hash: 753159ab6c2b24afec36b349d27ad3778d5f479684c1c0ddbe9b57c378a92fa6, 耗时:20s
2024-11-25 11:46:30.179  INFO 3845102 [internal-task-thread-0] c.e.c.e.c.runnable.ExchangeTransferTask  : --------------下单第三步:DOT(DOT)_XRP(XRP) 兑换结束: 状态: true, 数量: 13.98600000, orderId: EPL229B3712FB5C4FDA99EFB46BB3645B2D, 参数:{"amount":13.98600000,"contractAddress":"","fromAddress":"rLHUm6jyCN77BuigrTMHBrkUjstd5mEdgt","memoId":404094525,"name":"XRP","network":"XRP","orderId":"EPL229B3712FB5C4FDA99EFB46BB3645B2D","status":"WAITING_EXCHANGE","tag":40409452,"targetType":"USER","toAddress":"rnM7pNxm2mpEky891CrGc3waDJFqzryFkK","transferNetwork":"XRP","triggerType":"NORMAL"}, 结果:{"status":true,"txHash":"753159ab6c2b24afec36b349d27ad3778d5f479684c1c0ddbe9b57c378a92fa6"}
```

### 对冲的日志过程

- 

```sh

```



## 买币卖币

```sh
# 通用
tail -f -n 1111 /data/repos/exchange/logs/fiat-moonpay-5052.log
```

## data数据模块

```sh
# 通用
tail -f -n 111 /data/repos/exchange/logs/crypto-data-5001.log
```





# portal模块

```sh
# 通用
tail -f -n 111 /data/repos/exchange/logs/crypto-portal-5010.log
```

